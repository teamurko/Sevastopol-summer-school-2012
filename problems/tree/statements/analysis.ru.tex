Решается за $O(n \log^2(n))$. В каждой вершине храним set, при слиянии
множеств меньшее добавляем в большее, таким образом
каждый элемент будет добавлен в set не более $\log(n)$ раз, потому
что после слияния множество, в которое попал данный элемент
хотя бы удваивается.
